<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>SM Plumber - Material Estimate</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --primary: #111;
      --accent: #FFD700;
      --accent2: #FFEA00;
      --danger: #ef4444;
      --gray: #222;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: #111;
      color: #fff;
    }

    .container {
      max-width: 1150px;
      margin: 25px auto;
      background: rgba(0,0,0,0.82);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.8);
      border: 1px solid rgba(255,215,0,0.3);
    }

    .header {
      background: #111;
      padding: 30px 15px;
      text-align: center;
      position: relative;
      border-bottom: 2px solid var(--accent);
    }

    .header-logo {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  margin-bottom: 10px;
  border: 3px solid var(--accent);
  animation: glowPulse 2s infinite ease-in-out;
  transition: transform 0.4s ease;
}

/* Golden Glow Animation */
@keyframes glowPulse {
  0% {
    box-shadow: 
      0 0 10px rgba(255,215,0,0.6),
      0 0 20px rgba(255,215,0,0.4),
      0 0 30px rgba(255,215,0,0.3);
  }
  50% {
    box-shadow: 
      0 0 20px rgba(255,215,0,1),
      0 0 40px rgba(255,215,0,0.8),
      0 0 60px rgba(255,215,0,0.6);
  }
  100% {
    box-shadow: 
      0 0 10px rgba(255,215,0,0.6),
      0 0 20px rgba(255,215,0,0.4),
      0 0 30px rgba(255,215,0,0.3);
  }
}

/* Hover Zoom Effect */
.header-logo:hover {
  transform: scale(1.1);
}


    h1 {
      font-size: 2.3rem;
      color: var(--accent);
      margin: 0;
    }

    .info {
      padding: 25px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
    }

    .info label {
      font-weight: 500;
      margin-bottom: 6px;
      display: block;
      color: var(--accent2);
    }

    .info input {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid #444;
      background: #222;
      color: #FFD;
      font-size: 15px;
    }

    .info input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent);
      outline: none;
    }

    .big-title {
      text-align: center;
      padding: 18px;
      font-size: 1.3rem;
      font-weight: 600;
      background: #222;
      border-left: 6px solid var(--accent);
      margin: 20px 0 12px;
      color: var(--accent);
    }

    .acc-header {
      margin: 10px 18px;
      padding: 16px 20px;
      border-radius: 14px;
      background: #222;
      cursor: pointer;
      font-weight: 500;
      color: var(--accent2);
      border-left: 4px solid var(--accent);
      transition: 0.3s;
    }

    .acc-header:hover {
      background: #111;
      transform: translateY(-2px);
    }

    .acc-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, padding 0.4s ease;
      padding: 0 18px;
    }

    .acc-content.open {
      max-height: 9000px;
      padding: 18px;
    }

    .item {
      display: grid;
      gap: 15px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,215,0,0.2);
      align-items: center;
    }

    .item span, .item input.name {
      font-weight: 500;
      color: #FFD;
    }

    .item input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #444;
      text-align: center;
      background: #222;
      color: #FFD;
    }

    .add-btn {
      display: block;
      margin: 18px auto;
      padding: 12px 24px;
      background: var(--accent2);
      color: #111;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    #generateListBtn {
      display: block;
      margin: 40px auto;
      padding: 16px 45px;
      font-size: 18px;
      font-weight: 600;
      background: var(--accent);
      color: #111;
      border: none;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(255,215,0,0.6);
      cursor: pointer;
    }

    /* ====================== BUTTON STYLES ====================== */
    button {
      cursor: pointer;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px) scale(1.04);
    }

    .btn-yellow {
      background: #FFD700;
      color: #111;
      padding: 10px 18px;
    }

    .btn-yellow:hover {
      background: #FFEA00;
    }

    .btn-orange {
      background: #222;
      color: #FFEA00;
      padding: 10px 18px;
      border: 1px solid #FFD700;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
      padding: 10px 18px;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .close-btn {
      background: #ef4444 !important;
      color: white !important;
      padding: 14px 50px !important;
      font-size: 17px !important;
      margin: 35px auto !important;
      display: block !important;
      box-shadow: 0 8px 25px rgba(239,68,68,0.4) !important;
    }

    .close-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 12px 30px rgba(239,68,68,0.6) !important;
    }

    .whatsapp-btn {
      background: #25D366;
      color: white;
      padding: 12px 28px;
      border-radius: 50px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 6px 20px rgba(37,211,102,0.45);
    }

    .whatsapp-btn:hover {
      background: #20ba5a;
      transform: translateY(-4px) scale(1.06);
    }

    /* ====================== MODAL ====================== */
    #listModal, #historyModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 20px 10px;
      overflow-y: auto;
      z-index: 10000;
    }

    .historyContent {
      background: #111;
      border: 2px solid var(--accent);
      border-radius: 20px;
      padding: 25px;
      max-width: 960px;
      width: 100%;
      box-shadow: 0 0 50px rgba(255,215,0,0.5);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th {
      background: #222;
      color: var(--accent);
      padding: 10px;
    }

    td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid rgba(255,215,0,0.2);
      color: #FFD;
    }

    tr:hover { background: rgba(255,215,0,0.08); }

    /* Hamburger & Sidebar */
    .hamburger {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 45px;
      height: 45px;
      background: #FFD700;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 2001;
    }

    .hamburger div {
      width: 22px;
      height: 3px;
      background: #111;
      position: relative;
    }

    .hamburger div::before,
    .hamburger div::after {
      content: "";
      position: absolute;
      width: 22px;
      height: 3px;
      background: #111;
    }

    .hamburger div::before { top: -7px; }
    .hamburger div::after  { top: 7px; }

    .hamburger.active div { background: transparent; }
    .hamburger.active div::before { transform: rotate(45deg); top: 0; }
    .hamburger.active div::after  { transform: rotate(-45deg); top: 0; }

    .sidebar {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      height: 75%;
      background: linear-gradient(180deg, #111, #222);
      border-top-left-radius: 25px;
      border-top-right-radius: 25px;
      box-shadow: 0 -10px 30px rgba(255,215,0,0.3);
      transition: bottom 0.4s ease;
      z-index: 2000;
      overflow-y: auto;
      padding: 40px 20px;
    }

    .sidebar.active { bottom: 0; }

    .sidebar img {
      width: 100px;
      display: block;
      margin: 0 auto 20px;
    }

    .sidebar a {
      display: block;
      padding: 12px 15px;
      margin: 4px 0;
      text-align: center;
      font-size: 17px;
      color: #FFD700;
      text-decoration: none;
      border-radius: 8px;
      transition: 0.3s;
    }

    .sidebar a:hover {
      background: rgba(255,215,0,0.1);
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(6px);
      display: none;
      z-index: 1500;
    }

    .overlay.active { display: block; }

    /* Responsive */
    @media (max-width: 600px) {
      .info { grid-template-columns: 1fr; }
      .item { grid-template-columns: 1fr !important; }
      .item input { width: 100%; }
      #generateListBtn { padding: 14px 35px; font-size: 16px; }
      .header h1 { font-size: 1.9rem; }
    }
  </style>
</head>
<body>

  <!-- Popup for delete -->
  <div id="customPopup" class="popup-overlay" style="display:none;">
    <div class="popup-box">
      <h2>SM Plumber</h2>
      <p id="popupMessage">Are you sure?</p>
      <div style="display:flex; gap:12px; margin-top:20px;">
        <button class="btn-danger" onclick="confirmAction()">Yes</button>
        <button class="btn-yellow" onclick="document.getElementById('customPopup').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Hamburger -->
  <div class="hamburger" onclick="toggleMenu()">
    <div></div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebarMenu">
    <img src="logo.png" alt="Materials" onerror="this.style.display='none'">
    <a href="#" onclick="closeMenu()">üè† Home</a>
    <a href="#" onclick="openHistoryFromMenu()">üìú History</a>
    <a href="pluimg.html" onclick="closeMenu()">üñºÔ∏è Materials Image</a>
  </div>

  <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

  <div class="container">
    <div class="header">
      <div style="text-align:center;">
        <img src="logo.png" alt="SM Plumber Logo" class="header-logo" onerror="this.style.display='none'">
        <h1>SM Plumber</h1>
      </div>
    </div>

    <div class="info">
      <div><label>Customer Name</label><input id="custName" type="text"></div>
      <div><label>Address</label><input id="custAddress" type="text"></div>
      <div><label>Customer Mobile</label><input id="phone" type="tel" placeholder="Enter mobile number"></div>
    </div>

    <!-- Your sections remain the same -->
    <div class="big-title">PIPE ESTIMATE</div>
    <div class="acc-header" onclick="toggleAccordion(this)">PIPE MATERIALS <span>‚ñº</span></div>
    <div class="acc-content" id="pipeMaterialsSec"><div id="pipeMaterialsItems"></div><button class="add-btn" onclick="addExtra('pipeMaterialsItems')">+ Extra Pipe Material</button></div>

    <div class="acc-header" onclick="toggleAccordion(this)">PIPE FITTINGS <span>‚ñº</span></div>
    <div class="acc-content" id="pipeFittingsSec"><div id="pipeFittingsItems"></div><button class="add-btn" onclick="addExtra('pipeFittingsItems')">+ Extra Pipe Fitting</button></div>

    <div class="acc-header" onclick="toggleAccordion(this)">VALVES <span>‚ñº</span></div>
    <div class="acc-content" id="valvesSec"><div id="valvesItems"></div><button class="add-btn" onclick="addExtra('valvesItems')">+ Extra Valve</button></div>

    <div class="big-title">DRAINAGE ESTIMATE</div>
    <div class="acc-header" onclick="toggleAccordion(this)">DRAINAGE & SEWERAGE FITTINGS <span>‚ñº</span></div>
    <div class="acc-content" id="drainageSec"><div id="drainageItems"></div><button class="add-btn" onclick="addExtra('drainageItems')">+ Extra Drainage Item</button></div>

    <div class="big-title">STORAGE SYSTEMS</div>
    <div class="acc-header" onclick="toggleAccordion(this)">WATER STORAGE & PUMPING SYSTEMS <span>‚ñº</span></div>
    <div class="acc-content" id="waterStorageSec"><div id="waterStorageItems"></div><button class="add-btn" onclick="addExtra('waterStorageItems')">+ Extra Storage Item</button></div>

    <div class="big-title">FITTINGS ESTIMATE</div>
    <div class="acc-header" onclick="toggleAccordion(this)">BATHROOM & KITCHEN FITTINGS <span>‚ñº</span></div>
    <div class="acc-content" id="bathroomSec"><div id="bathroomItems"></div><button class="add-btn" onclick="addExtra('bathroomItems')">+ Extra Fitting</button></div>

    <div class="big-title">ACCESSORIES</div>
    <div class="acc-header" onclick="toggleAccordion(this)">PLUMBING ACCESSORIES <span>‚ñº</span></div>
    <div class="acc-content" id="accessoriesSec"><div id="accessoriesItems"></div><button class="add-btn" onclick="addExtra('accessoriesItems')">+ Extra Accessory</button></div>

    <button id="generateListBtn">Generate Materials List</button>
  </div>

  <!-- List Modal (same layout as original) -->
  <div id="listModal" style="display:none;">
    <div class="historyContent">
      <div id="listContent">
        <h2>Materials List</h2>
        <div id="listHeader" style="margin-bottom:15px; line-height:1.6;"></div>
        <table>
          <thead>
            <tr>
              <th>Sl No</th>
              <th>Item</th>
              <th>Size</th>
              <th>Qty</th>
            </tr>
          </thead>
          <tbody id="listTable"></tbody>
        </table>

        <div style="text-align:center; margin-top:25px; display:flex; justify-content:center; gap:15px; flex-wrap:wrap;">
          <button class="btn-yellow" onclick="downloadList()">üì• JPG</button>
          <button class="btn-yellow" onclick="downloadListPDF()">üìÑ PDF</button>
          <button class="whatsapp-btn" onclick="shareMaterialListOnWhatsApp()">
            Share on WhatsApp
          </button>
        </div>

        <button class="close-btn" onclick="document.getElementById('listModal').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div id="historyModal" style="display:none;">
    <div class="historyContent">
      <h2>History</h2>
      <div id="historyList" style="margin:20px 0;"></div>
      <button class="close-btn" onclick="document.getElementById('historyModal').style.display='none'">Close</button>
    </div>
  </div>

  <script>
    window.billHistory = JSON.parse(localStorage.getItem("smHistory")) || [];

    const size10 = ['¬Ω"','¬æ"','1"','1.25"','1.5"','2"','2.5"','3"','4"','6"'];
    const size5  = ['75mm','100mm','150mm','300mm','450mm'];

    const categories = {
      pipeMaterials:    { id:'pipeMaterialsItems',    type:'size10', items:['PVC Pipe','CPVC Pipe','UPVC Pipe','GI Pipe','PEX Pipe','SWR Pipe','HDPE Pipe'] },
      pipeFittings:     { id:'pipeFittingsItems',     type:'size10', items:['PVC Elbow','PVC Tee','PVC Coupler','PVC Reducer','FTA','MTA','UPVC Ball Valve','UPVC Union','CPVC Elbow'] },
      valves:           { id:'valvesItems',           type:'size10', items:['Bib Cock','Angle Valve','Stop Cock','Ball Valve','Gate Valve','NRV'] },
      drainage:         { id:'drainageItems',         type:'size5',  items:['S-Trap','P-Trap','Floor Trap','Gully Trap','Sewer Coupling'] },
      waterStorage:     { id:'waterStorageItems',     type:'general',items:['Overhead Tank','Underground Tank','Submersible Pump','Booster Pump'] },
      bathroom:         { id:'bathroomItems',         type:'general',items:['Wall Mixer','Health Faucet','Sink Mixer','Toilet (WC)','Kitchen Sink','Shower Set'] },
      accessories:      { id:'accessoriesItems',      type:'general',items:['Solvent Cement','Teflon Tape','Pipe Clamp','Tank Connector'] }
    };

    function loadItems() {
      Object.values(categories).forEach(cat => {
        document.getElementById(cat.id).innerHTML = '';
        cat.items.forEach(name => {
          document.getElementById(cat.id).appendChild(createItemRow(name, cat.type));
        });
      });
    }

    function createItemRow(name, type) {
      const div = document.createElement('div');
      div.className = 'item';

      if (type === 'general') {
        div.style.gridTemplateColumns = '2fr 80px 60px';
        div.innerHTML = `
          <span>${name}</span>
          <input type="text" class="size" placeholder="Size">
          <input type="number" class="qty" min="0">
        `;
      } else {
        const sizes = type === 'size10' ? size10 : size5;
        div.style.gridTemplateColumns = `2fr repeat(${sizes.length}, 60px)`;
        let html = `<span>${name}</span>`;
        sizes.forEach(s => {
          html += `<input type="number" class="qty" min="0" data-size="${s}" placeholder="${s}">`;
        });
        div.innerHTML = html;
      }
      return div;
    }

    function addExtra(id) {
      const cont = document.getElementById(id);
      let type = '';
      for (let k in categories) if (categories[k].id === id) type = categories[k].type;

      const div = document.createElement('div');
      div.className = 'item';

      if (type === 'general') {
        div.style.gridTemplateColumns = '2fr 80px 60px';
        div.innerHTML = `
          <input type="text" value="Extra Item" class="name">
          <input type="text" class="size" placeholder="Size">
          <input type="number" class="qty" min="0">
        `;
      } else {
        const sizes = type === 'size10' ? size10 : size5;
        div.style.gridTemplateColumns = `2fr repeat(${sizes.length}, 60px)`;
        let html = `<input type="text" value="Extra" class="name">`;
        sizes.forEach(s => html += `<input type="number" class="qty" min="0" data-size="${s}" placeholder="${s}">`);
        div.innerHTML = html;
      }
      cont.appendChild(div);
    }

    document.getElementById('generateListBtn').onclick = generateList;

    function generateList() {
      const items = [];

      document.querySelectorAll('.item').forEach(row => {
        const nameEl = row.querySelector('span, .name');
        const name = (nameEl?.value || nameEl?.textContent || '').trim();
        if (!name) return;

        const qtyInputs = row.querySelectorAll('.qty');
        let hasQty = false;
        qtyInputs.forEach(inp => { if (Number(inp.value) > 0) hasQty = true; });
        if (!hasQty) return;

        if (qtyInputs.length > 1) {
          qtyInputs.forEach(inp => {
            const qty = Number(inp.value);
            if (qty > 0) {
              items.push({ name, size: inp.dataset.size || '', qty });
            }
          });
        } else {
          const qty = Number(qtyInputs[0]?.value || 0);
          if (qty > 0) {
            items.push({
              name,
              size: row.querySelector('.size')?.value.trim() || '',
              qty
            });
          }
        }
      });

      if (items.length === 0) return alert("‡§ï‡•ã‡§à ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§≠‡§∞‡•Ä ‡§ó‡§à!");

      const tbody = document.getElementById('listTable');
      tbody.innerHTML = items.map((it,i) => `
        <tr>
          <td>${i+1}</td>
          <td>${it.name}</td>
          <td>${it.size}</td>
          <td>${it.qty}</td>
        </tr>
      `).join('');

      const now = new Date().toLocaleString('en-IN', {dateStyle:'medium', timeStyle:'short'});
      const name  = document.getElementById('custName').value.trim()   || 'Unknown';
      const addr  = document.getElementById('custAddress').value.trim() || '-';
      const phone = document.getElementById('phone').value.trim()      || '-';

      document.getElementById('listHeader').innerHTML = `
        <b>Date:</b> ${now}<br>
        <b>Customer:</b> ${name}<br>
        <b>Address:</b> ${addr}<br>
        <b>Mobile:</b> ${phone}
      `;

      document.getElementById('listModal').style.display = 'block';
      window.billHistory.push({ date: now, customer: name, address: addr, mobile: phone, items });
      localStorage.setItem("smHistory", JSON.stringify(window.billHistory));
    }

    function showHistory() {
      const cont = document.getElementById('historyList');
      cont.innerHTML = '';

      if (window.billHistory.length === 0) {
        cont.innerHTML = `<p style="text-align:center; color:#aaa; padding:40px;">‡§ï‡•ã‡§à ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</p>`;
      } else {
        window.billHistory.forEach((h, i) => {
          cont.innerHTML += `
            <div style="border:2px solid #FFD700; padding:25px; margin:20px 0; background:#111; border-radius:18px;">
              <div style="text-align:center; margin-bottom:15px;">
                <img src="logo.png" width="65" style="margin-bottom:8px;">
                <h3 style="color:#FFD700; margin:0;">SM Plumber</h3>
              </div>
              <div style="line-height:1.8;">
                <b>Date:</b> ${h.date}<br>
                <b>Customer:</b> ${h.customer || 'Unknown'}<br>
                <b>Mobile:</b> ${h.mobile || '-'}<br>
                <b>Items:</b> ${h.items.length}
              </div>
              <div style="margin-top:20px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
                <button class="btn-yellow" onclick="downloadHistoryList(${i})">üì• JPG</button>
                <button class="btn-yellow" onclick="downloadHistoryPDF(${i})">üìÑ PDF</button>
                <button class="btn-orange" onclick="downloadMaterialListPDF(${i})">üìã Material List</button>
                <button class="btn-danger" onclick="deleteHistory(${i})">üóë Delete</button>
              </div>
            </div>`;
        });
      }

      document.getElementById('historyModal').style.display = 'block';
    }

    function deleteHistory(idx) {
      if (!confirm("‡§á‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) return;
      window.billHistory.splice(idx, 1);
      localStorage.setItem("smHistory", JSON.stringify(window.billHistory));
      showHistory();
    }

    function downloadList() {
  const rows = document.getElementById('listTable').innerHTML;
  const header = document.getElementById('listHeader').innerText;

  const temp = document.createElement("div");
  temp.style.background = "#ffffff";
  temp.style.color = "#000000";
  temp.style.padding = "40px";
  temp.style.width = "900px";
  temp.style.fontFamily = "Arial";

  temp.innerHTML = `
    <div style="text-align:center; margin-bottom:25px; color:#000;">
      <img src="logo.png" style="width:100px;"><br>
      <h2 style="margin:10px 0; color:#000;">SM Plumber</h2>
      <b style="color:#000;">Mobile: 8935883863</b>
    </div>

    <div style="margin-bottom:20px; line-height:1.7; color:#000;">
      ${header.replace(/\n/g,"<br>")}
    </div>

    <table border="1" width="100%" 
      style="border-collapse:collapse; text-align:center; color:#000;">
      <thead>
        <tr>
          <th style="background:none; color:#000;">Sl No</th>
          <th style="background:none; color:#000;">Item</th>
          <th style="background:none; color:#000;">Size</th>
          <th style="background:none; color:#000;">Qty</th>
        </tr>
      </thead>
      <tbody style="color:#000;">
        ${rows.replace(/<td/g,'<td style="color:#000;"')}
      </tbody>
    </table>
  `;

  document.body.appendChild(temp);

  html2canvas(temp, { scale: 3, backgroundColor: "#ffffff" }).then(canvas => {
    const link = document.createElement("a");
    link.download = "SM_Materials_List.jpg";
    link.href = canvas.toDataURL("image/jpeg", 1.0);
    link.click();
    document.body.removeChild(temp);
  });
}





    function downloadListPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const rows = Array.from(document.querySelectorAll('#listTable tr')).map(r => [
    r.cells[0].innerText,
    r.cells[1].innerText,
    r.cells[2].innerText,
    r.cells[3].innerText
  ]);

  const img = new Image();
  img.src = "logo.png";

  img.onload = function () {

    doc.setFillColor(255,255,255);
    doc.rect(0,0,210,297,"F");

    doc.addImage(img,"PNG",85,10,40,40);

    doc.setFontSize(18);
    doc.setTextColor(0,0,0);
    doc.text("SM Plumber",105,60,{align:"center"});

    doc.setFontSize(12);
    doc.text("Mobile: 8935883863",105,68,{align:"center"});

    doc.setFontSize(11);
    doc.text(document.getElementById("listHeader").innerText,20,80);

    doc.autoTable({
      startY: 100,
      head: [['Sl No','Item','Size','Qty']],
      body: rows,
      theme: "grid",
      styles: { fontSize: 10, textColor:[0,0,0] },
      headStyles: { fillColor:[240,240,240], textColor:[0,0,0] }
    });

    doc.save("SM_Materials_List.pdf");
  };
}



    function downloadHistoryList(index) {
  const h = window.billHistory[index];

  const temp = document.createElement("div");
  temp.style.background = "#ffffff";
  temp.style.color = "#000";
  temp.style.padding = "40px";
  temp.style.width = "900px";
  temp.style.fontFamily = "Arial";

  let rows = h.items.map((it,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${it.name}</td>
      <td>${it.size}</td>
      <td>${it.qty}</td>
    </tr>
  `).join("");

  temp.innerHTML = `
    <div style="text-align:center; margin-bottom:25px; color:#000;">
      <img src="logo.png" style="width:100px;"><br>
      <h2 style="color:#000;">SM Plumber</h2>
      <b style="color:#000;">Mobile: 8935883863</b>
    </div>

    <div style="margin-bottom:20px; line-height:1.7; color:#000;">
      <b>Date:</b> ${h.date}<br>
      <b>Customer:</b> ${h.customer}<br>
      <b>Mobile:</b> ${h.mobile}
    </div>

    <table border="1" width="100%" 
      style="border-collapse:collapse; text-align:center; color:#000;">
      <thead>
        <tr>
          <th style="background:none; color:#000;">Sl No</th>
          <th style="background:none; color:#000;">Item</th>
          <th style="background:none; color:#000;">Size</th>
          <th style="background:none; color:#000;">Qty</th>
        </tr>
      </thead>
      <tbody style="color:#000;">
  ${rows.replace(/<td/g,'<td style="color:#000;"')}
</tbody>

    </table>
  `;

  document.body.appendChild(temp);

  html2canvas(temp,{scale:3,backgroundColor:"#ffffff"}).then(canvas=>{
    const link=document.createElement("a");
    link.download=`SM_History_${index+1}.jpg`;
    link.href=canvas.toDataURL("image/jpeg",1.0);
    link.click();
    document.body.removeChild(temp);
  });
}


   function downloadHistoryPDF(index) {
  const h = window.billHistory[index];
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const img = new Image();
  img.src = "logo.png";

  img.onload = function () {

    doc.setFillColor(255,255,255);
    doc.rect(0,0,210,297,"F");

    doc.addImage(img,"PNG",85,10,40,40);

    doc.setFontSize(18);
    doc.setTextColor(0,0,0);
    doc.text("SM Plumber",105,60,{align:"center"});

    doc.setFontSize(12);
    doc.text("Mobile: 8935883863",105,68,{align:"center"});

    doc.setFontSize(11);
    doc.text(`Date: ${h.date}`,20,80);
    doc.text(`Customer: ${h.customer}`,20,87);
    doc.text(`Mobile: ${h.mobile}`,20,94);

    doc.autoTable({
      startY:110,
      head:[['Sl No','Item','Size','Qty']],
      body:h.items.map((it,i)=>[i+1,it.name,it.size,it.qty]),
      theme:"grid",
      styles:{fontSize:10,textColor:[0,0,0]},
      headStyles:{fillColor:[240,240,240],textColor:[0,0,0]}
    });

    doc.save(`SM_History_${index+1}.pdf`);
  };
}


    function downloadMaterialListPDF(index) {
      downloadHistoryPDF(index); // same as above for now
    }

    function shareMaterialListOnWhatsApp() {
      const phone = document.getElementById('phone').value.trim().replace(/\D/g,'');
      if (!phone) return alert("Customer mobile number ‡§°‡§æ‡§≤‡•á‡§Ç");

      let wa = phone.startsWith('91') ? phone : '91' + phone.replace(/^0/,'');

      const lines = Array.from(document.querySelectorAll('#listTable tr')).map((r,i) => {
        if (!r.cells) return '';
        return `${i}. ${r.cells[1].innerText} (${r.cells[2].innerText}) √ó ${r.cells[3].innerText}`;
      }).filter(Boolean);

      const msg = `*SM Plumber*\n\n${document.getElementById('listHeader').innerText}\n\n${lines.join('\n')}\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!\n8935883863`;

      window.open(`https://wa.me/${wa}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function toggleAccordion(el) {
      el.classList.toggle('active');
      el.nextElementSibling.classList.toggle('open');
    }

    function toggleMenu() {
      document.querySelector('.hamburger').classList.toggle('active');
      document.getElementById('sidebarMenu').classList.toggle('active');
      document.getElementById('overlay').classList.toggle('active');
    }

    function closeMenu() {
      document.querySelector('.hamburger').classList.remove('active');
      document.getElementById('sidebarMenu').classList.remove('active');
      document.getElementById('overlay').classList.remove('active');
    }

    function openHistoryFromMenu() {
      closeMenu();
      showHistory();
    }

    loadItems();
  </script>
</body>
</html>