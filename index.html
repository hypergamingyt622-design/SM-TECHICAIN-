<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>SM Technician - Full Estimate</title>

  <!-- Favicon -->

  <link rel="icon" type="image/png" href="logo.png">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {

      --primary: #111;

      /* Dark background */

      --accent: #FFD700;

      /* Electric yellow */

      --accent2: #FFEA00;

      /* Lighter yellow highlight */

      --success: #10b981;

      --danger: #ef4444;

      --glass: rgba(255, 255, 255, 0.05);

    }

    * {

      margin: 0;

      padding: 0;

      box-sizing: border-box;

    }

    body {

      font-family: 'Poppins', sans-serif;

      min-height: 100vh;

      background: #111;

      color: #fff;

    }

    /* MAIN CONTAINER */

    .container {

      max-width: 1150px;

      margin: 25px auto;

      background: rgba(0, 0, 0, 0.8);

      backdrop-filter: blur(12px);

      border-radius: 20px;

      overflow: hidden;

      box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);

      border: 1px solid rgba(255, 215, 0, 0.3);

    }

    /* HEADER */

    .header {

      background: #111;

      padding: 30px 15px;

      text-align: center;

      position: relative;

      border-bottom: 2px solid var(--accent);

    }

    .header h1 {

      font-size: 2.3rem;

      letter-spacing: 1px;

      color: var(--accent);

    }

    .header-logo {

      width: 110px;

      height: 110px;

      border-radius: 50%;

      margin-bottom: 10px;

      box-shadow: 0 10px 25px rgba(255, 215, 0, 0.5);

      border: 2px solid var(--accent);

    }

    /* INFO SECTION */

    .info {

      padding: 25px;

      display: grid;

      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));

      gap: 20px;

    }

    .info label {

      font-weight: 500;

      margin-bottom: 6px;

      display: block;

      color: var(--accent2);

    }

    .info input {

      width: 100%;

      padding: 14px;

      border-radius: 12px;

      border: 1px solid #444;

      background: #222;

      color: #FFD;

      outline: none;

      transition: 0.3s;

    }

    .info input:focus {

      border-color: var(--accent);

      box-shadow: 0 0 10px var(--accent);

      background: #333;

    }

    /* BIG TITLE */

    .big-title {

      text-align: center;

      padding: 18px;

      font-size: 1.3rem;

      font-weight: 600;

      background: #222;

      border-left: 6px solid var(--accent);

      margin: 20px 0 12px;

      letter-spacing: 1px;

      color: var(--accent);

    }

    /* ACCORDION HEADER */

    .acc-header {

      margin: 10px 18px;

      padding: 16px 20px;

      border-radius: 14px;

      background: #222;

      cursor: pointer;

      transition: 0.3s;

      font-weight: 500;

      color: var(--accent2);

      border-left: 4px solid var(--accent);

    }

    .acc-header:hover {

      background: #111;

      transform: translateY(-2px);

    }

    /* CONTENT */

    .acc-content {

      max-height: 0;

      overflow: hidden;

      transition: max-height 0.5s ease;

      padding: 0 18px;

    }

    .acc-content.open {

      max-height: 9000px;

      padding: 18px;

    }

    /* ITEM ROW */

    .item {

      display: grid;

      grid-template-columns: 2fr 80px 100px 70px;

      gap: 15px;

      padding: 12px 0;

      border-bottom: 1px solid rgba(255, 215, 0, 0.2);

      align-items: center;

    }

    .item span {

      font-weight: 500;

      color: #FFD;

    }

    .item input {

      padding: 10px;

      border-radius: 8px;

      border: 1px solid #444;

      text-align: center;

      background: #222;

      color: #FFD;

    }

    @media(max-width:600px) {

      .item {

        grid-template-columns: 1fr;

      }

    }

    /* BUTTONS */

    button {

      cursor: pointer;

      border: none;

      border-radius: 10px;

      transition: all 0.3s ease;

      font-weight: 600;

    }

    button:hover {

      transform: translateY(-3px) scale(1.05);

    }

    .edit {

      background: #FFD700;

      color: #111;

      padding: 8px 10px;

    }

    .edit:hover {

      transform: scale(1.05);

    }

    .add-btn {

      display: block;

      margin: 18px auto;

      padding: 12px 24px;

      background: #FFEA00;

      color: #111;

      font-size: 14px;

    }

    .add-btn:hover {

      background: #FFD700;

    }

    /* GENERATE BILL */

    #generateBillBtn {

      display: block;

      margin: 40px auto;

      padding: 16px 45px;

      font-size: 18px;

      font-weight: 600;

      background: var(--accent);

      color: #111;

      border-radius: 14px;

      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);

    }

    #generateBillBtn:hover {

      transform: scale(1.05);

      box-shadow: 0 12px 35px rgba(255, 215, 0, 0.8);

    }

    /* MODAL */

    #billContent,

    .historyContent {

      background: #111;

      color: #FFD;

      border-radius: 20px;

      padding: 25px;

      box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);

      border: 2px solid var(--accent);

    }

    #billContent h2,

    .historyContent h2 {

      color: var(--accent);

      text-align: center;

    }

    #billContent table,

    .historyContent table {

      width: 100%;

      border-collapse: collapse;

      margin-top: 15px;

    }

    #billContent th {

      background: #222;

      color: var(--accent);

      padding: 10px;

    }

    #billContent td {

      padding: 10px;

      text-align: center;

      border-bottom: 1px solid rgba(255, 215, 0, 0.2);

      color: #FFD;

    }

    #billContent tr:hover {

      background: rgba(255, 215, 0, 0.1);

    }

    #billContent h3 {

      color: #FFEA00;

      font-size: 20px;

      text-align: right;

    }

    #billContent button,

    #historyModal button {

      margin-top: 20px;

      padding: 10px 25px;

      border: none;

      border-radius: 10px;

      background: var(--accent);

      color: #111;

      cursor: pointer;

      font-weight: 600;

    }

    #billContent button:hover,

    #historyModal button:hover {

      transform: scale(1.05);

      background: #FFD700;

    }

    /* SEARCH BAR */

    .top-search-container {

      padding: 20px;

      display: grid;

      grid-template-columns: 1fr 1fr;

      gap: 15px;

      background: #222;

    }

    .top-search {

      padding: 14px 18px;

      border-radius: 14px;

      border: 1px solid #444;

      font-size: 15px;

      background: #111;

      color: #FFD;

    }

    .top-search::placeholder {

      color: #FFEA00;

    }

    .top-search:focus {

      border-color: var(--accent);

      box-shadow: 0 0 10px var(--accent);

      background: #222;

    }

    /* HISTORY BUTTON */

    #historyBtn {

      position: absolute;

      top: 20px;

      right: 20px;

      padding: 10px 20px;

      border-radius: 8px;

      background: var(--accent);

      color: #111;

      font-weight: 600;

      cursor: pointer;

      box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);

    }

    #historyBtn:hover {

      transform: scale(1.05);

      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.7);

    }

    /* FOOTER */

    footer {

      text-align: center;

      padding: 20px;

      font-size: 14px;

      background: #111;

      border-top: 2px solid var(--accent);

      color: var(--accent2);

    }

    /* ===== PAGE LOAD ANIMATION ===== */

    .container {

      animation: fadeInUp 0.8s ease forwards;

      opacity: 0;

      transform: translateY(30px);

    }

    @keyframes fadeInUp {

      to {

        opacity: 1;

        transform: translateY(0);

      }

    }

    /* ===== ACCORDION ARROW ROTATION ===== */

    .acc-header span {

      float: right;

      transition: transform 0.3s ease;

    }

    .acc-header.active span {

      transform: rotate(180deg);

    }

    /* ===== ACCORDION SMOOTH SLIDE ===== */

    .acc-content {

      transition: max-height 0.5s ease, padding 0.4s ease;

    }

    /* ===== ITEM HOVER LIFT ===== */

    .item {

      transition: transform 0.3s ease, background 0.3s ease;

    }

    .item:hover {

      transform: translateX(5px);

      background: rgba(255, 215, 0, 0.05);

    }

    /* ===== BUTTON GLOW PULSE ===== */

    #generateBillBtn {

      animation: pulseGlow 2s infinite;

    }

    @keyframes pulseGlow {

      0% {

        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);

      }

      50% {

        box-shadow: 0 0 25px rgba(255, 215, 0, 1);

      }

      100% {

        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);

      }

    }

    /* ===== MODAL SMOOTH OPEN ===== */

    #billContent,

    .historyContent {

      animation: zoomIn 0.4s ease;

    }

    @keyframes zoomIn {

      from {

        transform: scale(0.85);

        opacity: 0;

      }

      to {

        transform: scale(1);

        opacity: 1;

      }

    }

    .header-logo {

      border-radius: 50%;

      border: 3px solid #FFD700;

      animation: pulseGlow 2s infinite;

    }

    @keyframes pulseGlow {

      0%,

      100% {

        box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);

      }

      50% {

        box-shadow: 0 0 40px rgba(255, 215, 0, 1);

      }

    }

    /* Hamburger Icon */

    /* ===== HAMBURGER (LEFT TOP) ===== */

    .hamburger {

      position: absolute;

      top: 20px;

      left: 20px;

      width: 45px;

      height: 45px;

      background: #FFD700;

      border-radius: 10px;

      display: flex;

      justify-content: center;

      align-items: center;

      cursor: pointer;

      z-index: 2001;

    }

    .hamburger div {

      width: 22px;

      height: 3px;

      background: #111;

      position: relative;

    }

    .hamburger div::before,

    .hamburger div::after {

      content: "";

      position: absolute;

      width: 22px;

      height: 3px;

      background: #111;

      transition: 0.3s;

    }

    .hamburger div::before {

      top: -7px;

    }

    .hamburger div::after {

      top: 7px;

    }

    .hamburger.active div {

      background: transparent;

    }

    .hamburger.active div::before {

      transform: rotate(45deg);

      top: 0;

    }

    .hamburger.active div::after {

      transform: rotate(-45deg);

      top: 0;

    }

    /* ===== SIDEBAR BOTTOM SLIDE ===== */

    .sidebar {

      position: fixed;

      bottom: -100%;

      left: 0;

      width: 100%;

      height: 75%;

      background: linear-gradient(180deg, #111, #222);

      border-top-left-radius: 25px;

      border-top-right-radius: 25px;

      box-shadow: 0 -10px 30px rgba(255, 215, 0, 0.3);

      transition: 0.4s ease;

      z-index: 2000;

      overflow-y: auto;

      padding: 40px 20px;

    }

    .sidebar.active {

      bottom: 0;

    }

    /* Scrollbar style */

    .sidebar::-webkit-scrollbar {

      width: 6px;

    }

    .sidebar::-webkit-scrollbar-thumb {

      background: #FFD700;

      border-radius: 10px;

    }

    /* Menu links */

    .sidebar a {

      display: block;

      padding: 12px 15px;

      /* kam padding */

      margin: 4px 0;

      /* kam space */

      text-align: center;

      font-size: 17px;

      color: #FFD700;

      text-decoration: none;

      border-radius: 8px;

      transition: 0.3s;

    }

    .sidebar a:hover {

      background: rgba(255, 215, 0, 0.1);

    }

    /* Overlay */

    .overlay {

      position: fixed;

      inset: 0;

      background: rgba(0, 0, 0, 0.4);

      backdrop-filter: blur(6px);

      display: none;

      z-index: 1500;

    }

    .overlay.active {

      display: block;

    }

    /* ===== CUSTOM POPUP ===== */

    .popup-overlay {

      position: fixed;

      inset: 0;

      background: rgba(0, 0, 0, 0.7);

      backdrop-filter: blur(6px);

      display: none;

      justify-content: center;

      align-items: center;

      z-index: 15000;

    }

    .popup-box {

      background: linear-gradient(135deg, #111, #222);

      padding: 30px;

      width: 320px;

      border-radius: 20px;

      text-align: center;

      border: 2px solid #FFD700;

      box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);

      animation: popupZoom 0.4s ease;

    }

    @keyframes popupZoom {

      from {

        transform: scale(0.7);

        opacity: 0;

      }

      to {

        transform: scale(1);

        opacity: 1;

      }

    }

    .popup-box h2 {

      color: #FFD700;

      margin-bottom: 15px;

    }

    .popup-box p {

      margin-bottom: 20px;

      color: #fff;

    }

    .popup-buttons {

      display: flex;

      justify-content: space-between;

      gap: 10px;

    }

    .popup-confirm {

      flex: 1;

      background: #FFD700;

      color: #111;

      padding: 10px;

      border: none;

      border-radius: 8px;

      font-weight: 600;

    }

    .popup-cancel {

      flex: 1;

      background: #ef4444;

      color: white;

      padding: 10px;

      border: none;

      border-radius: 8px;

      font-weight: 600;

    }

    .popup-confirm:hover,

    .popup-cancel:hover {

      transform: scale(1.05);

    }





    /* Freeze body scrolling when any modal is open */
    body.modal-active {
      overflow: hidden;
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    /* History modal background with blur + dark overlay */
    #historyModal {
      position: fixed;
      inset: 0;
      z-index: 10000;
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 20px 10px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.65);
      /* dark overlay */
      backdrop-filter: blur(6px);
      /* main blur effect */
      -webkit-backdrop-filter: blur(6px);
      /* Safari */
    }

    /* Make sure content stays above the blurred background */
    .historyContent {
      position: relative;
      z-index: 2;
      background: rgba(17, 17, 17, 0.94);
      border: 1px solid rgba(255, 215, 0, 0.35);
      border-radius: 16px;
      max-width: 960px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
    }

    /* Optional: stronger blur when modal is open */
    #historyModal.active {
      backdrop-filter: blur(8px);
      background: rgba(0, 0, 0, 0.72);
    }

    /* When any modal-like thing is open using .overlay */
.overlay.active {
    display: block;
    background: rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}

/* Make sure history modal content stays crisp */
.historyContent {
    background: rgba(17, 17, 17, 0.94);
    backdrop-filter: none;     /* ‚Üê important: don't blur inside content */
}
  </style>

</head>

<body>

  <!-- Custom Popup -->

  <div id="customPopup" class="popup-overlay">

    <div class="popup-box">

      <h2>SM Technician</h2>

      <p id="popupMessage">Are you sure?</p>

      <div class="popup-buttons">

        <button onclick="confirmAction()" class="popup-confirm">Yes</button>

        <button onclick="closePopup()" class="popup-cancel">Cancel</button>

      </div>

    </div>

  </div>

  <!-- Hamburger Icon -->

  <div class="header"></div>

    <div class="hamburger" onclick="toggleMenu()">

      <div></div>

      <div></div>

      <div></div>

    </div>

    <!-- Sidebar Menu -->

    <div class="sidebar" id="sidebarMenu">

      <a href="#" onclick="closeMenu()">üè† Home</a>

      <a href="cal.html">üßÆ Point Calculator</a>

      <a href="inst.html">üí° Installation Price</a>

      <a href="rep.html">üîß Repairing Price</a>

      <a href="rule.html">üìú Rule</a>

      <a href="#" onclick="openHistoryFromMenu()">üìú History</a>

      <hr style="margin:20px 0;border-color:#FFD700;">

      <a href="#" onclick="logoutUser()" style="color:#ef4444;font-weight:bold;">

        üîì Logout

      </a>

    </div>

    <div class="container">

      <div class="header">

        <div style="text-align:center;">

          <img src="logo.png" alt="SM Technician Logo" class="header-logo" onerror="this.style.display='none'">

          <h1>SM Technician</h1>

        </div>

      </div>

      <div class="info">

        <div><label>Customer Name</label><input id="custName" type="text"></div>

        <div><label>Address</label><input id="custAddress" type="text"></div>

        <div><label>Mobile Number</label><input id="phone" type="tel" placeholder="Enter mobile number"></div>

      </div>

      <div class="top-search-container">

        <input type="text" id="materialSearch" class="top-search" placeholder="üîç Search Material Name...">

      </div>

      <!-- ALL SECTIONS FROM data.pdf (100% SERIAL) -->

      <div class="big-title">LIGHTING ESTIMATE</div>

      <div class="acc-header" onclick="toggleAccordion(this)">LIGHT <span>‚ñº</span></div>

      <div class="acc-content" id="lightSec">

        <div class="items" id="lightItems"></div><button class="add-btn" onclick="addExtra('lightItems')">+ Extra

          Light</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">STRIP LIGHT <span>‚ñº</span></div>

      <div class="acc-content" id="stripSec">

        <div class="items" id="stripItems"></div><button class="add-btn" onclick="addExtra('stripItems')">+ Extra

          Strip</button>

      </div>

      <div class="big-title">WIRING ESTIMATE</div>

      <div class="acc-header" onclick="toggleAccordion(this)">WIRE <span>‚ñº</span></div>

      <div class="acc-content" id="wireSec">

        <div class="items" id="wireItems"></div><button class="add-btn" onclick="addExtra('wireItems')">+ Extra

          Wire</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">EARTHING <span>‚ñº</span></div>

      <div class="acc-content" id="earthingSec">

        <div class="items" id="earthingItems"></div><button class="add-btn" onclick="addExtra('earthingItems')">+ Extra

          Earthing</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">FAN HOOK <span>‚ñº</span></div>

      <div class="acc-content" id="fanhookSec">

        <div class="items" id="fanhookItems"></div><button class="add-btn" onclick="addExtra('fanhookItems')">+ Extra

          Fan

          Hook</button>

      </div>

      <div class="big-title">WALL PIPING ESTIMATES</div>

      <div class="acc-header" onclick="toggleAccordion(this)">PVC CONDUIT PIPE <span>‚ñº</span>

      </div>

      <div class="acc-content" id="pvcSec">

        <div class="items" id="pvcItems"></div><button class="add-btn" onclick="addExtra('pvcItems')">+ Extra PVC

          Pipe</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">JUNCTION BOX <span>‚ñº</span></div>

      <div class="acc-content" id="junctionSec">

        <div class="items" id="junctionItems"></div><button class="add-btn" onclick="addExtra('junctionItems')">+ Extra

          Junction Box</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">METAL BOX <span>‚ñº</span></div>

      <div class="acc-content" id="metalSec">

        <div class="items" id="metalItems"></div><button class="add-btn" onclick="addExtra('metalItems')">+ Extra Metal

          Box</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">EXTRA MATERIAL <span>‚ñº</span>

      </div>

      <div class="acc-content" id="wallExtraSec">

        <div class="items" id="wallExtraItems"></div><button class="add-btn" onclick="addExtra('wallExtraItems')">+

          Extra

          Material</button>

      </div>

      <div class="big-title">LENTAR PIPING ESTIMATE</div>

      <div class="acc-header" onclick="toggleAccordion(this)">PVC CONDUIT PIPE <span>‚ñº</span>

      </div>

      <div class="acc-content" id="lentarpvcSec">

        <div class="items" id="lentarpvcItems"></div><button class="add-btn" onclick="addExtra('lentarpvcItems')">+

          Extra

          PVC</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">BOX & BEND <span>‚ñº</span></div>

      <div class="acc-content" id="boxbendSec">

        <div class="items" id="boxbendItems"></div><button class="add-btn" onclick="addExtra('boxbendItems')">+ Extra

          Box

          & Bend</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">EXTRA MATERIAL <span>‚ñº</span>

      </div>

      <div class="acc-content" id="lentarExtraSec">

        <div class="items" id="lentarExtraItems"></div><button class="add-btn" onclick="addExtra('lentarExtraItems')">+

          Extra Material</button>

      </div>

      <div class="big-title">MODULAR SWITCH BOARD ESTIMATE</div>

      <div class="acc-header" onclick="toggleAccordion(this)">SWITCH & SOCKET <span>‚ñº</span>

      </div>

      <div class="acc-content" id="switchSec">

        <div class="items" id="switchItems"></div><button class="add-btn" onclick="addExtra('switchItems')">+ Extra

          Switch</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">MODULAR PLATE <span>‚ñº</span>

      </div>

      <div class="acc-content" id="plateSec">

        <div class="items" id="plateItems"></div><button class="add-btn" onclick="addExtra('plateItems')">+ Extra

          Plate</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">MCB's <span>‚ñº</span></div>

      <div class="acc-content" id="mcbSec">

        <div class="items" id="mcbItems"></div><button class="add-btn" onclick="addExtra('mcbItems')">+ Extra

          MCB</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">SCREWS <span>‚ñº</span></div>

      <div class="acc-content" id="screwsSec">

        <div class="items" id="screwsItems"></div><button class="add-btn" onclick="addExtra('screwsItems')">+ Extra

          Screw</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">EXTRA MATERIAL <span>‚ñº</span>

      </div>

      <div class="acc-content" id="modularExtraSec">

        <div class="items" id="modularExtraItems"></div><button class="add-btn"
          onclick="addExtra('modularExtraItems')">+

          Extra Material</button>

      </div>

      <div class="big-title">FALL CEILING WIRING ESTIMATES</div>

      <div class="acc-header" onclick="toggleAccordion(this)">MATERIAL <span>‚ñº</span></div>

      <div class="acc-content" id="fallMaterialSec">

        <div class="items" id="fallMaterialItems"></div><button class="add-btn"
          onclick="addExtra('fallMaterialItems')">+

          Extra Material</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">WIRE <span>‚ñº</span></div>

      <div class="acc-content" id="fallWireSec">

        <div class="items" id="fallWireItems"></div><button class="add-btn" onclick="addExtra('fallWireItems')">+ Extra

          Wire</button>

      </div>

      <div class="big-title">CASING CAPPING</div>

      <div class="acc-header" onclick="toggleAccordion(this)">Material <span>‚ñº</span></div>

      <div class="acc-content" id="casingSec">

        <div class="items" id="casingItems"></div><button class="add-btn" onclick="addExtra('casingItems')">+ Extra

          Casing</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">SURFACE BOARD's <span>‚ñº</span>

      </div>

      <div class="acc-content" id="surfaceSec">

        <div class="items" id="surfaceItems"></div><button class="add-btn" onclick="addExtra('surfaceItems')">+ Extra

          Surface Board</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">MCB's <span>‚ñº</span></div>

      <div class="acc-content" id="fallMcbSec">

        <div class="items" id="fallMcbItems"></div><button class="add-btn" onclick="addExtra('fallMcbItems')">+ Extra

          MCB</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">SWITCH & SOCKET <span>‚ñº</span>

      </div>

      <div class="acc-content" id="fallSwitchSec">

        <div class="items" id="fallSwitchItems"></div><button class="add-btn" onclick="addExtra('fallSwitchItems')">+

          Extra Switch</button>

      </div>

      <div class="big-title">WIRE MATERIAL</div>

      <div class="acc-header" onclick="toggleAccordion(this)">WIRE MATERIAL <span>‚ñº</span>

      </div>

      <div class="acc-content" id="wireMaterialSec">

        <div class="items" id="wireMaterialItems"></div><button class="add-btn"
          onclick="addExtra('wireMaterialItems')">+

          Extra Wire</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">SCREWS <span>‚ñº</span></div>

      <div class="acc-content" id="fallScrewsSec">

        <div class="items" id="fallScrewsItems"></div><button class="add-btn" onclick="addExtra('fallScrewsItems')">+

          Extra Screw</button>

      </div>

      <div class="acc-header" onclick="toggleAccordion(this)">EXTRA MATERIAL <span>‚ñº</span>

      </div>

      <div class="acc-content" id="fallExtraSec">

        <div class="items" id="fallExtraItems"></div><button class="add-btn" onclick="addExtra('fallExtraItems')">+

          Extra

          Material</button>

      </div>

    </div>

    <button id="generateBillBtn" style="

display:block;

margin:30px auto;

padding:15px 40px;

font-size:18px;

background:#2563eb;

color:white;

border:none;

border-radius:10px;

cursor:pointer;

">

      Generate Bill

    </button>

    <div id="billModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);overflow:auto;">

      <div id="billContent">

        <div style="text-align:center;">

          <img src="logo.png" style="width:80px;">

          <h2>SM Technician</h2>

          <div>Mobile No: 8935883863</div>

        </div>

        <div style="display:flex;justify-content:space-between;margin:10px 0;">

          <div id="billLeftInfo"></div>

        </div>

        <table border="1" width="100%" cellspacing="0" cellpadding="5">

          <thead>

            <tr>

              <th>Sl No</th>

              <th>Item</th>

              <th>Qty</th>

              <th>Rate</th>

              <th>Price</th>

            </tr>

          </thead>

          <tbody id="billTableBody"></tbody>

        </table>

        <h3 style="text-align:right;margin-top:2px;">Total: ‚Çπ<span id="billTotal"></span></h3>

        <div style="text-align:center;margin-top:20px;">

          <button onclick="downloadBill()">Download JPG</button>

          <button onclick="downloadBillPDF()">Download PDF</button>

          <button onclick="shareMaterialListOnWhatsApp()">Share on WhatsApp</button>

          <button onclick="closeBill()">Close</button>

        </div>

      </div>

    </div>

    <div id="historyModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);overflow:auto;">

      <div class="historyContent">

        <h2 style="text-align:center;">Bill History</h2>

        <div id="historyList"></div>

        <button onclick="closeHistory()">Close</button>

      </div>

    </div>

    <footer>SM Technician ‚Ä¢ 8935883863</footer>

    <script>

      // ================== 100% DATA FROM data.pdf ==================

      const data = {

        lightItems: ["Panel light", "COB light", "LED Bulb", "Tube light", "Rope light", "Rope light adaptor", "Foot light", "Surface light", "Insulation strip"],

        stripItems: ["Strip Channel", "Strip light", "Strip adaptor", "Strip jointer (shape)", "Strip jointer (straight)"],

        wireItems: ["Copper Wire 0.75mm", "Copper Wire 1mm", "Copper Wire 1.5mm", "Copper Wire 2.5mm", "Copper Wire 4mm", "Copper Wire 6mm", "Copper Wire 10mm", "Armoured cable 2 core", "Armoured cable 4 core", "DTH cable", "Speaker wire", "Camera wire", "Wire spring"],

        earthingItems: ["Earthing wire", "Earthing plate", "Brass nut bolt", "Charcoal", "Salt", "GI rod", "Copper rod", "Earthing chemical", "Cocopeat / soil enhancer"],

        fanhookItems: ["Fan hook", "Fanner 8no.", "Araldite solvent"],

        pvcItems: ["PVC pipe 25mm (1.5mm)", "PVC pipe 20mm (1.5mm)", "Flexible pipe 25mm", "Flexible pipe 20mm", "Coupling / socket"],

        junctionItems: ["Junction box 25mm (1,2 way)", "Junction box 25mm (3,4 way)", "Junction box 20mm (1,2 way)", "Junction box 20mm (3,4 way)", "PVC bend 25mm", "PVC bend 20mm", "Insulation tape"],

        metalItems: ["Metal box 2M", "Metal box 3M", "Metal box 4M", "Metal box 6M", "Metal box 8M (Sq)", "Metal box 8M (rect)", "Metal box 12M", "Metal box 18M", "MCB box single door", "MCB box double door"],

        wallExtraItems: ["Saddle / kaju clip 20mm", "Saddle / kaju clip 25mm", "GI earthing wire (kg)", "Nail (2.5 inch)"],

        lentarpvcItems: ["PVC conduit pipe 25mm (2mm)", "PVC conduit pipe 20mm (2mm)"],

        boxbendItems: ["Concealed box (1,2 way)", "Concealed box (3,4 way)", "Fan box 20mm", "Fan box 25mm", "Deep box 20mm (1,2 way)", "Deep box 20mm (3,4 way)", "Deep box 25mm (1,2 way)", "Deep box 25mm (3,4 way)", "PVC Bend 20mm", "PVC Bend 25mm"],

        lentarExtraItems: ["Cpvc solvent", "Insulation tape", "End cap", "Coupling / socket 20mm (2mm)", "Coupling / socket 25mm (2mm)"],

        switchItems: ["Switch 6Amp", "Switch 16Amp", "DP switch", "5pin Socket 6Amp", "5pin Socket 16Amp", "2pin Socket", "Regulator", "Damy", "USB", "Bell switch", "Fuse switch", "Indicator", "Two way switch", "TV outlet"],

        plateItems: ["Plate 1 module", "Plate 2 module", "Plate 3 module", "Plate 4 module", "Plate 6 module", "Plate 8 module (square)", "Plate 8 module (rectangular)", "Plate 12 module", "Plate 18 module"],

        mcbItems: ["MCB 6Amp", "MCB 10Amp", "MCB 16Amp", "MCB 20Amp", "MCB 25Amp", "MCB 32Amp", "MCB 32Amp (___ pole)", "MCB (64Amp) (___ pole)", "MCCB (___ Amp) (___ pole)", "Isolator 32Amp (___ pole)", "Isolator 64Amp (___ pole)", "Isolator 100Amp (___ pole)", "RCCBO (___ Amp) (___ pole)", "RCCB (___ Amp) (___ pole)", "Kitkat Fuse (___ Amp)", "Terminal blocks (___ Amp)", "Bus bar DB (___ Amp)", "Changeover MCB (___ Amp) (___ pole)", "PVC cable Tie"],

        screwsItems: ["Star Screw (1.5 inch)", "Star Screw (1 inch)", "Star Screw (2 inch)", "Star Screw (2.5 inch)", "Star Screw (4 inch)", "3/16 Bolt (___ inch)"],

        modularExtraItems: ["Angle holder", "Batten holder", "Pendant holder", "Ceiling rose", "Round damy sheet", "Fan damy sheet", "Insulation tape", "Indicator bulb"],

        fallMaterialItems: ["PVC pipe 25mm (1.5mm)", "PVC pipe 20mm (1.5mm)", "Flexible pipe 25mm", "Flexible pipe 20mm", "Junction box 25mm (1,2 way)", "Junction box 25mm (3,4 way)", "Junction box 20mm (1,2 way)", "Junction box 20mm (3,4 way)", "PVC bend 25mm", "PVC bend 20mm", "Insulation tape"],

        fallWireItems: ["Copper Wire 0.75mm", "Copper Wire 1mm", "Copper Wire 1.5mm", "Copper Wire 2.5mm", "Copper Wire 4mm", "Copper Wire 6mm", "Copper Wire 10mm", "DTH cable", "Speaker wire", "Fan hook", "Camera wire", "Wire spring", "Fastener 8 no.", "Saddle clip 25mm", "Special Saddle 25mm", "Rawal plug (____ mm)", "Screw (____ mm)", "PCV insulation tape"],

        casingItems: ["Casing capping", "Coupling", "Elbow joint", "Tee joint", "Doctor joint", "Internal bend", "External bend", "Reducer", "Square box", "Junction box", "Round block", "Panel trunking", "Electrical gang box", "MCB board (___ way)", "MCB board metal (___ way)"],

        surfaceItems: ["Surface board (1 module)", "Surface board (2 module)", "Surface board (3 module)", "Surface board (4 module)", "Surface board (6 module)", "Surface board (8 module) (sqr)", "Surface board (8 module) (rect)", "Surface board (12 module)", "Surface board (18 module)"],

        fallMcbItems: ["MCB 6Amp", "MCB 10Amp", "MCB 16Amp", "MCB 20Amp", "MCB 25Amp", "MCB 32Amp", "MCB 32Amp (___ pole)", "MCB (64Amp) (___ pole)", "MCCB (___ Amp) (___ pole)", "Isolator 32Amp (___ pole)", "Isolator 64Amp (___ pole)", "Isolator 100Amp (___ pole)", "RCCBO (___ Amp) (___ pole)", "RCCB (___ Amp) (___ pole)", "Kitkat Fuse (___ Amp)", "Terminal blocks (___ Amp)", "Bus bar DB (___ Amp)", "Changeover MCB (___ Amp) (___ pole)", "PVC cable Tie"],

        fallSwitchItems: ["Switch 6Amp", "Switch 16Amp", "DP switch", "5pin Socket 6Amp", "5pin Socket 16Amp", "2pin Socket", "Regulator", "Damy", "USB", "Bell switch", "Fuse switch", "Indicator", "Two way switch", "TV outlet"],

        wireMaterialItems: ["Copper Wire 1mm", "Copper Wire 1.5mm", "Copper Wire 2.5mm", "Copper Wire 4mm", "Copper Wire 6mm", "Copper Wire 10mm", "Armoured cable 2core (......mm)", "Armoured cable 4core (......mm)", "DTH cable", "Speaker wire", "Camera wire", "Wire spring"],

        fallScrewsItems: ["Star Screw (1.5 inch)", "Star Screw (1 inch)", "Star Screw (2 inch)", "Star Screw (2.5 inch)", "Star Screw (4 inch)", "3/16 Bolt (____ inch)", "Rawal plug"],

        fallExtraItems: ["Angle holder", "Batten holder", "Pendant holder", "Ceiling rose", "Round damy sheet", "Fan damy sheet", "Insulation tape", "Indicator bulb"]

      };

      // ‚Üê‚Üê‚Üê YE LINE ADD KARO (commented wali hata do)

      window.savedRates = JSON.parse(localStorage.getItem('smRates')) || {};

      window.billHistory = JSON.parse(localStorage.getItem("smHistory")) || [];

      // let billHistory = JSON.parse(localStorage.getItem("smHistory")) || [];

      // window.billHistory = billHistory;

      // Populate all items

      Object.keys(data).forEach(key => {

        const container = document.getElementById(key);

        if (!container) return;

        data[key].forEach(name => {

          const div = document.createElement('div');

          div.className = 'item';

          div.dataset.name = name;

          const savedRate = savedRates[name] || '';

          div.innerHTML = `

      <span>${name}</span>

      <input type="number" class="qty" value="0" min="0">

      <input type="number" class="rate" placeholder="Rate" min="0" value="${savedRate}" readonly>

      <button class="edit" onclick="editItem(this)">Edit</button>

    `;

          container.appendChild(div);

          div.querySelector('.rate').addEventListener('input', async (e) => {

            window.savedRates[name] = e.target.value;

            localStorage.setItem('smRates', JSON.stringify(window.savedRates));

            // Firestore mein save

            if (window.currentUserUid && window.db) {

              const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");

              const userRef = doc(window.db, "users", window.currentUserUid);

              await setDoc(userRef, { rates: window.savedRates }, { merge: true });

            }

          });

        });

      });

      function addExtra(id) {

        const container = document.getElementById(id);

        const div = document.createElement('div');

        div.className = 'item';

        div.innerHTML = `

    <input type="text" placeholder="New Item Name" style="padding:8px;border:1px solid #ccc;border-radius:6px;">

    <input type="number" class="qty" value="0" min="0">

    <input type="number" class="rate" placeholder="Rate" min="0" readonly>

    <button class="edit" onclick="editItem(this)">Edit</button>

  `;

        container.appendChild(div);

      }

      function editItem(btn) {

        const item = btn.parentElement;

        const nameEl = item.querySelector('span') || item.querySelector('input[type="text"]');

        const rateEl = item.querySelector('.rate');

        if (btn.textContent === "Edit") {

          // Name unlock

          if (nameEl.tagName === "SPAN") {

            const input = document.createElement("input");

            input.type = "text";

            input.value = nameEl.textContent;

            input.style.padding = "8px";

            input.style.border = "1px solid #ccc";

            input.style.borderRadius = "6px";

            nameEl.replaceWith(input);

          }

          // Rate unlock

          rateEl.removeAttribute("readonly");

          btn.textContent = "Save";

          btn.style.background = "#16a34a";

        } else {

          // Name lock

          const nameInput = item.querySelector('input[type="text"]');

          if (nameInput) {

            const span = document.createElement("span");

            span.textContent = nameInput.value;

            item.insertBefore(span, nameInput);

            nameInput.remove();

          }

          // Rate lock

          rateEl.setAttribute("readonly", true);

          btn.textContent = "Edit";

          btn.style.background = "#f59e0b";

        }

      }

      // Quantity auto clear zero on focus

      document.addEventListener("focusin", function (e) {

        if (e.target.classList.contains("qty")) {

          if (e.target.value === "0") {

            e.target.value = "";

          }

        }

      });

      document.addEventListener("focusout", function (e) {

        if (e.target.classList.contains("qty")) {

          if (e.target.value === "") {

            e.target.value = "0";

          }

        }

      });

      // ===== GLOBAL MATERIAL SEARCH =====

      document.getElementById("materialSearch").addEventListener("input", function () {

        const value = this.value.toLowerCase().trim();

        const allAccordions = document.querySelectorAll(".acc-content");

        // Agar search empty hai ‚Üí sab close karo

        if (value === "") {

          document.querySelectorAll(".item").forEach(item => {

            item.style.display = "grid";

          });

          allAccordions.forEach(acc => {

            acc.classList.remove("open");

          });

          return;

        }

        // Agar search me kuch likha hai

        document.querySelectorAll(".item").forEach(item => {

          const nameEl = item.querySelector("span") || item.querySelector("input[type='text']");

          const name = nameEl ? (nameEl.value || nameEl.textContent).toLowerCase() : "";

          if (name.includes(value)) {

            item.style.display = "grid";

            const accContent = item.closest(".acc-content");

            if (accContent) accContent.classList.add("open");

          } else {

            item.style.display = "none";

          }

        });

      });

      document.getElementById("generateBillBtn").onclick = generateBill;

      function generateBill() {

        const items = document.querySelectorAll(".item");

        const tbody = document.getElementById("billTableBody");

        tbody.innerHTML = "";

        let total = 0;

        let count = 1;

        items.forEach(item => {

          const qty = parseFloat(item.querySelector(".qty")?.value) || 0;

          const rate = parseFloat(item.querySelector(".rate")?.value) || 0;

          const nameEl = item.querySelector("span") || item.querySelector("input[type='text']");

          const name = nameEl ? (nameEl.value || nameEl.textContent) : "";

          if (qty > 0 && rate > 0) {

            const price = qty * rate;

            total += price;

            tbody.innerHTML += `

<tr>

  <td>${count++}</td>

  <td>${name}</td>

  <td>${qty}</td>

  <td>${rate}</td>

  <td>${price}</td>

</tr>

`;

          }

        });

        const now = new Date();

        const day = now.getDate().toString().padStart(2, "0");

        const month = (now.getMonth() + 1).toString().padStart(2, "0");

        const year = now.getFullYear();

        let hours = now.getHours();

        const minutes = now.getMinutes().toString().padStart(2, "0");

        const ampm = hours >= 12 ? "PM" : "AM";

        hours = hours % 12;

        hours = hours ? hours : 12;

        const formattedDate = `${day}/${month}/${year} ${hours}:${minutes} ${ampm}`;

        document.getElementById("billLeftInfo").innerHTML =

          "Date: " + formattedDate + "<br>" +

          "Customer: " + document.getElementById("custName").value;

        document.getElementById("billTotal").textContent = total.toFixed(2);
        
        document.getElementById("billModal").style.display = "block";
        document.body.classList.add("modal-active");

        saveHistory(formattedDate, total);

      }

      function closeBill() {

        document.getElementById("billModal").style.display = "none";
        document.body.classList.remove("modal-active");

      }

      async function saveHistory(date, total) {

        const itemsData = [];

        document.querySelectorAll(".item").forEach(item => {

          const qty = parseFloat(item.querySelector(".qty")?.value) || 0;

          const rate = parseFloat(item.querySelector(".rate")?.value) || 0;

          const nameEl = item.querySelector("span") || item.querySelector("input[type='text']");

          const name = nameEl ? (nameEl.value || nameEl.textContent) : "";

          if (qty > 0 && rate > 0) {

            itemsData.push({

              name,

              qty,

              rate,

              price: qty * rate

            });

          }

        });

        const newBill = {

          date,

          customer: document.getElementById("custName").value || "Unknown",

          address: document.getElementById("custAddress").value || "",

          mobile: document.getElementById("phone").value || "",

          total,

          items: itemsData

        };

        // Add to array

        window.billHistory.push(newBill);

        // Save in localStorage

        localStorage.setItem("smHistory", JSON.stringify(window.billHistory));

        // üî• Firestore save

        // ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê
        saveHistoryToFirestore();   // ‚Üê‚Üê‚Üê Yeh line add kar do
        // ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê


        // if (window.currentUserUid && window.db) {
        //   try {
        //     const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
        //     const userRef = doc(window.db, "users", window.currentUserUid);
        //     await setDoc(userRef, {
        //       history: window.billHistory
        //     }, { merge: true });
        //     console.log("‚úÖ History saved in Firestore");
        //   } catch (e) {
        //     console.error("‚ùå Firestore history save error:", e);
        //   }
        // }

      }

      function showHistory() {

        console.log("History showing, total bills:", window.billHistory.length);

        const list = document.getElementById("historyList");

        list.innerHTML = "";

        // Fallback if Firestore load slow hai

        if (window.billHistory.length === 0) {

          const local = JSON.parse(localStorage.getItem("smHistory")) || [];

          window.billHistory = local;

        }

        if (window.billHistory.length === 0) {

          list.innerHTML = `<p style="text-align:center; color:#aaa; padding:40px;">Abhi tak koi bill nahi bana hai</p>`;

          const modal = document.getElementById("historyModal");
          modal.style.display = "flex";           // flex use kar rahe hain centering ke liye
          modal.classList.add("active");          // blur/dark effect ke liye class
          document.body.classList.add("modal-active");   // background freeze + no scroll

          return;

        }

        window.billHistory.forEach((h, i) => {

          list.innerHTML += `

            <div style="border:2px solid #FFD700; padding:25px; margin:20px 0; background:#111; border-radius:18px; box-shadow:0 10px 30px rgba(255,215,0,0.2);">

                <div style="text-align:center; margin-bottom:15px;">

                    <img src="logo.png" width="65" style="margin-bottom:8px;">

                    <h3 style="color:#FFD700; margin:0;">SM Technician</h3>

                </div>

                <div style="text-align:left; line-height:1.8; color:#ddd;">

                    <b>Date:</b> ${h.date}<br>

                    <b>Customer:</b> ${h.customer || 'Unknown'}<br>

                    <b>Mobile:</b> ${h.mobile || '-'}<br>

                    <b>Address:</b> ${h.address || '-'}<br>

                    <b style="color:#FFEA00;">Total: ‚Çπ${h.total}</b>

                </div>

                <div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">

                    <button onclick="downloadHistoryBill(${i})" style="background:#FFD700; color:#111; padding:10px 18px; border:none; border-radius:8px; font-weight:600;">üì• JPG</button>

                    <button onclick="downloadHistoryPDF(${i})" style="background:#FFD700; color:#111; padding:10px 18px; border:none; border-radius:8px; font-weight:600;">üìÑ PDF</button>

                    <button onclick="downloadMaterialListPDF(${i})" style="background:#222; color:#FFEA00; padding:10px 18px; border:1px solid #FFD700; border-radius:8px; font-weight:600;">üìã Material List</button>

                    <button class="delete-history-btn" 
        data-index="${i}" 
        style="background:#ef4444; color:white; padding:10px 18px; border:none; border-radius:8px; font-weight:600;">
  üóë Delete
</button>

                </div>

            </div>

        `;

        });

       const modal = document.getElementById("historyModal");
    const overlay = document.getElementById("overlay");

    // Show both overlay and modal
    overlay.classList.add("active");
    modal.style.display = "flex";
    modal.classList.add("active");

    // Freeze body scroll (same as sidebar)
    document.body.classList.add("modal-active");
    // Optional: extra safety
    document.body.style.overflow = "hidden";
}

      function closeHistory() {
    const modal = document.getElementById("historyModal");
    const overlay = document.getElementById("overlay");

    modal.style.display = "none";
    modal.classList.remove("active");

    overlay.classList.remove("active");

    document.body.classList.remove("modal-active");
    document.body.style.overflow = "auto";   // restore scroll
}



      function downloadBill() {

        const bill = document.getElementById("billContent");

        const tempDiv = bill.cloneNode(true);

        tempDiv.style.background = "#ffffff";

        tempDiv.style.color = "#000000";

        tempDiv.style.width = "800px";

        tempDiv.style.padding = "30px";

        tempDiv.style.fontFamily = "Arial";

        // Force all text black

        tempDiv.querySelectorAll("*").forEach(el => {

          el.style.color = "#000000";

          el.style.background = "transparent";

        });

        document.body.appendChild(tempDiv);

        html2canvas(tempDiv, {

          scale: 3,

          backgroundColor: "#ffffff",

          useCORS: true

        }).then(canvas => {

          const link = document.createElement("a");

          link.download = "SM_Technician_Bill.jpg";

          link.href = canvas.toDataURL("image/jpeg", 1.0);

          link.click();

          document.body.removeChild(tempDiv);

        });

      }

      function downloadHistoryBill(index) {

        // const history = JSON.parse(localStorage.getItem("smHistory")) || [];

        const h = window.billHistory[index];

        const tempDiv = document.createElement("div");

        tempDiv.style.padding = "30px";

        tempDiv.style.background = "#ffffff";

        tempDiv.style.color = "#000000";

        tempDiv.style.width = "800px";

        tempDiv.style.fontFamily = "Arial";

        let rows = "";

        let count = 1;

        h.items.forEach(item => {

          rows += `

      <tr>

        <td>${count++}</td>

        <td>${item.name}</td>

        <td>${item.qty}</td>

        <td>${item.rate}</td>

        <td>${item.price}</td>

      </tr>

    `;

        });

        tempDiv.innerHTML = `

    <div style="text-align:center;">

      <img src="logo.png" style="width:90px;"><br>

      <h2 style="margin:5px 0;">SM Technician</h2>

      <div>Mobile No: 8935883863</div>

    </div>

    <div style="margin:15px 0;">

      <b>Date:</b> ${h.date}<br>

      <b>Customer:</b> ${h.customer}<br>

      <b>Address:</b> ${h.address}<br>

      <b>Mobile:</b> ${h.mobile}

    </div>

    <table border="1" width="100%" cellspacing="0" cellpadding="8" 

      style="border-collapse:collapse;text-align:center;">

      <thead>

        <tr>

          <th>Sl No</th>

          <th>Item</th>

          <th>Qty</th>

          <th>Rate</th>

          <th>Price</th>

        </tr>

      </thead>

      <tbody>

        ${rows}

      </tbody>

    </table>

    <h3 style="text-align:right;margin-top:15px;">

      Total: ‚Çπ${h.total}

    </h3>

  `;

        document.body.appendChild(tempDiv);

        html2canvas(tempDiv, {

          scale: 3,

          backgroundColor: "#ffffff",

          useCORS: true

        }).then(canvas => {

          const link = document.createElement("a");

          link.download = "SM_Technician_History_Bill.jpg";

          link.href = canvas.toDataURL("image/jpeg", 1.0);

          link.click();

          document.body.removeChild(tempDiv);

        });

      }

      function downloadHistoryPDF(index) {

        const { jsPDF } = window.jspdf;

        // const history = JSON.parse(localStorage.getItem("smHistory")) || [];

        const h = window.billHistory[index];

        const pdf = new jsPDF("p", "mm", "a4");

        const pageWidth = pdf.internal.pageSize.getWidth();

        let y = 15;

        const pageHeight = 280;

        // ===== SAME HEADER =====

        pdf.addImage("logo.png", "PNG", pageWidth / 2 - 12, y, 24, 24);

        y += 30;

        // ===== COMPANY NAME =====

        pdf.setFontSize(18);

        pdf.text("SM Technician", pageWidth / 2, y, { align: "center" });

        y += 8;

        pdf.setFontSize(11);

        pdf.text("Mobile No: 8935883863", pageWidth / 2, y, { align: "center" });

        y += 10;

        pdf.line(15, y, pageWidth - 15, y);

        y += 10;

        // ===== BILL INFO =====

        pdf.setFontSize(11);

        pdf.text("Date: " + h.date, 20, y);

        y += 6;

        pdf.text("Customer: " + h.customer, 20, y);

        y += 6;

        pdf.text("Address: " + h.address, 20, y);

        y += 6;

        pdf.text("Mobile: " + h.mobile, 20, y);

        y += 12;

        // ===== TABLE =====

        pdf.setFontSize(12);

        pdf.text("Sl", 20, y);

        pdf.text("Item", 35, y);

        pdf.text("Qty", 135, y);

        pdf.text("Rate", 155, y);

        pdf.text("Amount", 175, y);

        y += 8;

        let count = 1;

        h.items.forEach(item => {

          if (y > pageHeight) {

            pdf.addPage();

            y = 20;

          }

          pdf.text(String(count), 20, y);

          pdf.text(item.name.substring(0, 50), 35, y);

          pdf.text(String(item.qty), 135, y);

          pdf.text(String(item.rate), 155, y);

          pdf.text(String(item.price), 175, y);

          y += 7;

          count++;

        });

        y += 10;

        pdf.setFontSize(14);

        pdf.text("Total: Rs. " + h.total, pageWidth - 60, y);

        pdf.save("SM_Technician_Bill.pdf");

      }

      function downloadBillPDF() {

        const { jsPDF } = window.jspdf;

        const pdf = new jsPDF("p", "mm", "a4");

        const pageWidth = pdf.internal.pageSize.getWidth();

        let y = 15;

        const pageHeight = 280;

        // ===== LOGO CENTER SMALL =====

        pdf.addImage("logo.png", "PNG", pageWidth / 2 - 12, y, 24, 24);

        y += 30;

        // ===== COMPANY NAME =====

        pdf.setFontSize(18);

        pdf.text("SM Technician", pageWidth / 2, y, { align: "center" });

        y += 8;

        pdf.setFontSize(11);

        pdf.text("Mobile No: 8935883863", pageWidth / 2, y, { align: "center" });

        y += 10;

        pdf.line(15, y, pageWidth - 15, y);

        y += 10;

        // ===== CUSTOMER DETAILS =====

        pdf.setFontSize(11);

        pdf.text("Date: " + new Date().toLocaleString(), 15, y);

        y += 6;

        pdf.text("Customer: " + document.getElementById("custName").value, 15, y);

        y += 6;

        pdf.text("Address: " + document.getElementById("custAddress").value, 15, y);

        y += 6;

        pdf.text("Mobile: " + document.getElementById("phone").value, 15, y);

        y += 10;

        // ===== TABLE HEADER BOX =====

        pdf.setFontSize(12);

        pdf.rect(15, y, 180, 10); // outer box

        pdf.text("Sl", 18, y + 7);

        pdf.text("Item", 30, y + 7);

        pdf.text("Qty", 125, y + 7);

        pdf.text("Rate", 145, y + 7);

        pdf.text("Amount", 165, y + 7);

        y += 10;

        let total = 0;

        let count = 1;

        document.querySelectorAll(".item").forEach(item => {

          const qty = parseFloat(item.querySelector(".qty")?.value) || 0;

          const rate = parseFloat(item.querySelector(".rate")?.value) || 0;

          const nameEl = item.querySelector("span") || item.querySelector("input[type='text']");

          const name = nameEl ? (nameEl.value || nameEl.textContent) : "";

          if (qty > 0 && rate > 0) {

            if (y > pageHeight) {

              pdf.addPage();

              y = 20;

            }

            const price = qty * rate;

            total += price;

            pdf.rect(15, y, 180, 8);

            pdf.text(String(count), 18, y + 6);

            pdf.text(name.substring(0, 40), 30, y + 6);

            pdf.text(String(qty), 125, y + 6);

            pdf.text(String(rate), 145, y + 6);

            pdf.text(String(price.toFixed(2)), 165, y + 6);

            y += 8;

            count++;

          }

        });

        y += 10;

        // ===== TOTAL BOX =====

        pdf.setFontSize(14);

        pdf.rect(115, y - 6, 80, 10);

        pdf.text("Total: Rs. " + total.toFixed(2), 125, y);

        pdf.save("SM_Technician_Bill.pdf");

      }

      function downloadMaterialListPDF(index) {

        const { jsPDF } = window.jspdf;

        // const history = JSON.parse(localStorage.getItem("smHistory")) || [];

        const h = window.billHistory[index];

        const pdf = new jsPDF("p", "mm", "a4");

        const pageWidth = pdf.internal.pageSize.getWidth();

        let y = 15;

        const pageHeight = 280;

        // ===== SAME SMALL CENTER LOGO =====

        pdf.addImage("logo.png", "PNG", pageWidth / 2 - 12, y, 24, 24);

        y += 30;

        // ===== COMPANY NAME =====

        pdf.setFontSize(18);

        pdf.text("SM Technician", pageWidth / 2, y, { align: "center" });

        y += 8;

        pdf.setFontSize(11);

        pdf.text("Mobile No: 8935883863", pageWidth / 2, y, { align: "center" });

        y += 10;

        pdf.line(15, y, pageWidth - 15, y);

        y += 12;

        // ===== TABLE HEADER BOX =====

        pdf.setFontSize(12);

        pdf.rect(15, y, 180, 10);

        pdf.text("Sl", 18, y + 7);

        pdf.text("Item", 30, y + 7);

        pdf.text("Qty", 165, y + 7);

        y += 10;

        let count = 1;

        h.items.forEach(item => {

          if (y > pageHeight) {

            pdf.addPage();

            y = 20;

          }

          pdf.rect(15, y, 180, 8);

          pdf.text(String(count), 18, y + 6);

          pdf.text(item.name.substring(0, 45), 30, y + 6);

          pdf.text(String(item.qty), 165, y + 6);

          y += 8;

          count++;

        });

        pdf.save("SM_Technician_Material_List.pdf");

      }








async function shareMaterialListOnWhatsApp() {
    const phone = document.getElementById("phone").value.trim();
    
    if (!phone || phone.length < 9) {
        alert("Customer ka mobile number daaliye (kam se kam 9-10 digit)");
        return;
    }

    // International format mein convert (India ke liye +91 add)
    let whatsappNumber = phone;
    if (!phone.startsWith("+")) {
        if (phone.startsWith("0")) {
            whatsappNumber = "+91" + phone.substring(1);
        } else {
            whatsappNumber = "+91" + phone;
        }
    }

    // Material list collect karo (sirf item + qty)
    const items = [];
    document.querySelectorAll(".item").forEach(item => {
        const qty = parseFloat(item.querySelector(".qty")?.value) || 0;
        if (qty <= 0) return;

        const nameEl = item.querySelector("span") || item.querySelector("input[type='text']");
        const name = nameEl ? (nameEl.value || nameEl.textContent).trim() : "";
        
        if (name) {
            items.push(`${name} √ó ${qty}`);
        }
    });

    if (items.length === 0) {
        alert("Koi material select nahi kiya gaya hai!");
        return;
    }

    // Simple text message format
    const customerName = document.getElementById("custName").value.trim() || "Customer";
    const message = 
        `*SM Technician Estimate*\n\n` +
        `Dear ${customerName},\n\n` +
        `Yeh hai aapka material list:\n` +
        items.map((line, i) => `${i+1}. ${line}`).join("\n") +
        `\n\nTotal items: ${items.length}\n` +
        `Koi change chahiye to batayein.\n` +
        `Thanks! üôè\n` +
        `SM Technician - 8935883863`;

    // WhatsApp web / app link
    const waLink = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

    // Try to open WhatsApp
    try {
        window.open(waLink, "_blank");
    } catch (e) {
        alert("WhatsApp link khul nahi pa raha. Number check karein ya browser allow karein.");
    }
}








      function toggleAccordion(header) {

        const content = header.nextElementSibling;

        content.classList.toggle("open");

        header.classList.toggle("active");

      }

      function toggleMenu() {

        const sidebar = document.getElementById("sidebarMenu");

        const burger = document.querySelector(".hamburger");

        const overlay = document.getElementById("overlay");

        sidebar.classList.toggle("active");

        burger.classList.toggle("active");

        overlay.classList.toggle("active");

        document.body.style.overflow = sidebar.classList.contains("active") ? "hidden" : "auto";

      }

      function closeMenu() {

        const sidebar = document.getElementById("sidebarMenu");

        const burger = document.querySelector(".hamburger");

        const overlay = document.getElementById("overlay");

        sidebar.classList.remove("active");

        burger.classList.remove("active");

        overlay.classList.remove("active");

        document.body.style.overflow = "auto";

      }

      function openHistoryFromMenu() {

        closeMenu();   // pehle sidebar band karo

        showHistory(); // phir history open karo

      }

      let popupCallback = null;

      function showPopup(message, callback) {

        document.getElementById("popupMessage").textContent = message;

        document.getElementById("customPopup").style.display = "flex";

        popupCallback = callback;

      }

      function closePopup() {

        document.getElementById("customPopup").style.display = "none";

      }

      function confirmAction() {

        if (popupCallback) popupCallback();

        closePopup();

      }




// ================== DELETE BUTTON HANDLER (Fixed + Reliable) ==================
document.addEventListener('click', function (e) {
    // ‚Üê‚Üê‚Üê Yeh line important hai (text/emoji par click bhi catch karega)
    const deleteBtn = e.target.closest('.delete-history-btn');
    
    if (deleteBtn) {
        const index = parseInt(deleteBtn.dataset.index);
        
        if (isNaN(index)) return;

        console.log("‚úÖ Delete button clicked ‚Üí Index:", index);   // debugging ke liye

        showPopup("Kya aap is bill ko permanently delete karna chahte hain?", () => {
            // Delete karo
            window.billHistory.splice(index, 1);

            // LocalStorage update
            localStorage.setItem("smHistory", JSON.stringify(window.billHistory));

            // Firestore update
            saveHistoryToFirestore();

            // List refresh
            showHistory();
        });
    }
});

// Helper function to save history in Firestore
async function saveHistoryToFirestore() {
    if (!window.currentUserUid || !window.db) return;

    try {
        const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
        const userRef = doc(window.db, "users", window.currentUserUid);
        await setDoc(userRef, { history: window.billHistory }, { merge: true });
        console.log("‚úÖ History updated in Firestore after delete");
    } catch (e) {
        console.error("‚ùå Firestore delete error:", e);
    }
}



    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <!-- Aapka pura website ka code upar rahega -->

    <script type="module">

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

      import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {

        apiKey: "AIzaSyBYTLHO7jZW1dHEHlW55Axpjs2duSiDMs4",

        authDomain: "sm-technician-d4b8d.firebaseapp.com",

        projectId: "sm-technician-d4b8d",

        appId: "1:716505252423:web:fd557961c7c8eef03f6762"

      };

      const app = initializeApp(firebaseConfig);

      const auth = getAuth(app);

      const db = getFirestore(app);

      window.db = db;

      window.currentUserUid = null;

      // ===== AUTH CHECK =====

      onAuthStateChanged(auth, async (user) => {

        if (!user) {

          window.location.href = "login.html";

          return;

        }

        window.currentUserUid = user.uid;

        await loadUserData(user.uid);

      });

      // ===== LOAD USER DATA =====

      async function loadUserData(uid) {

        try {

          const userRef = doc(db, "users", uid);

          const snap = await getDoc(userRef);

          if (snap.exists()) {

            const data = snap.data();

            // Rates load

            if (data.rates) {

              Object.assign(window.savedRates, data.rates);

              localStorage.setItem('smRates', JSON.stringify(window.savedRates));

            }

            // History load

            if (data.history && Array.isArray(data.history)) {

              window.billHistory = data.history;

              localStorage.setItem("smHistory", JSON.stringify(window.billHistory));

            }

          }

        } catch (e) {

          console.error("Load error:", e);

        }

      }

      // ===== LOGOUT FUNCTION =====

      window.logoutUser = function () {

        showPopup("Logout karna chahte hain?", () => {

          signOut(auth).then(() => {

            window.location.href = "login.html";

          });

        });

        return;

      };

    </script>

</body>

</html>